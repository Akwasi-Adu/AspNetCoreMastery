<!DOCTYPE html>
<html lang="en">

<head>
  <meta name="description" content="Learn Mocking with Moq | ASP.NET Core Mastery in ASP.NET Core. Comprehensive tutorial with practical examples and best practices.">
  <meta name="keywords" content="ASP.NET Core, Mocking with Moq | ASP.NET Core Mastery, C# tutorial, web development">
  <meta name="author" content="Akwasi Adu-Kyeremeh">
  <link rel="canonical" href="https://aspnetcoremastery.akwasi.dev/part-16-testing/02-mocking-with-moq.html">
  
  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="article">
  <meta property="og:url" content="https://aspnetcoremastery.akwasi.dev/part-16-testing/02-mocking-with-moq.html">
  <meta property="og:title" content="Mocking with Moq | ASP.NET Core Mastery">
  <meta property="og:description" content="Learn Mocking with Moq | ASP.NET Core Mastery in ASP.NET Core. Comprehensive tutorial with practical examples and best practices.">
  <meta property="og:image" content="https://aspnetcoremastery.akwasi.dev/assets/og-image.png">
  
  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image">
  <meta property="twitter:url" content="https://aspnetcoremastery.akwasi.dev/part-16-testing/02-mocking-with-moq.html">
  <meta property="twitter:title" content="Mocking with Moq | ASP.NET Core Mastery">
  <meta property="twitter:description" content="Learn Mocking with Moq | ASP.NET Core Mastery in ASP.NET Core. Comprehensive tutorial with practical examples and best practices.">
  <meta property="twitter:image" content="https://aspnetcoremastery.akwasi.dev/assets/og-image.png">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mocking with Moq | ASP.NET Core Mastery</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,wght@0,400;0,500;0,600;0,700;1,400&family=JetBrains+Mono:wght@400;500&family=Source+Serif+4:ital,wght@0,400;0,600;1,400&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="../assets/style.css">
</head>

<body>
    <div class="page-wrapper">
        <aside class="sidebar">
            <a href="../index.html" class="sidebar-logo">ASP.NET Core Mastery</a>
            <div class="sidebar-section">Part XVI: Testing</div>
            <ul class="sidebar-nav">
                <li><a href="01-unit-testing-xunit.html">Unit Testing with xUnit</a></li>
                <li><a href="02-mocking-with-moq.html" class="active">Mocking with Moq</a></li>
                <li><a href="03-integration-testing.html">Integration Testing</a></li>
                <li><a href="04-webapplicationfactory.html">WebApplicationFactory</a></li>
                <li><a href="05-test-driven-development.html">Test-Driven Development</a></li>
            </ul>
            <div class="sidebar-section">Resources</div>
            <ul class="sidebar-nav">
                <li><a href="../index.html">Full Roadmap</a></li>
            </ul>
        </aside>

        <main class="main-content">
            <div class="content-container">
                <nav class="breadcrumb">
                    <a href="../index.html">Home</a>
                    <span>â†’</span>
                    <a href="01-unit-testing-xunit.html">Part XVI: Testing</a>
                    <span>â†’</span>
                    Mocking with Moq
                </nav>

                <div class="progress-indicator">
                    <span>Section 2 of 5</span>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 40%"></div>
                    </div>
                </div>

                <h1>Mocking with Moq</h1>

                <div class="learning-objectives">
                    <h3>ðŸŽ¯ What You'll Learn</h3>
                    <ul>
                        <li>What is mocking</li>
                        <li>Installing Moq</li>
                        <li>Creating mocks</li>
                        <li>Setup and Returns</li>
                        <li>Verify method calls</li>
                    </ul>
                </div>

                <h2>What is Mocking?</h2>

                <p>
                    <strong>Mocking</strong> creates fake implementations of dependencies to isolate the unit being
                    tested.
                    This allows testing without real databases, APIs, or other external dependencies.
                </p>

                <div class="section-divider"></div>

                <h2>Installing Moq</h2>

                <div class="code-header">
                    <span class="code-filename">Install Moq</span>
                    <span class="code-language">Bash</span>
                </div>
                <pre><code>dotnet add package Moq</code></pre>

                <div class="section-divider"></div>

                <h2>Creating Mocks</h2>

                <div class="code-header">
                    <span class="code-filename">Basic Mock</span>
                    <span class="code-language">C#</span>
                </div>
                <pre><code><span class="code-keyword">var</span> <span class="code-variable">mockRepository</span> = <span class="code-keyword">new</span> <span class="code-class">Mock</span>&lt;<span class="code-class">IProductRepository</span>&gt;();</code></pre>

                <div class="section-divider"></div>

                <h2>Setup and Returns</h2>

                <div class="code-header">
                    <span class="code-filename">Setup Method Behavior</span>
                    <span class="code-language">C#</span>
                </div>
                <pre><code><span class="code-keyword">var</span> <span class="code-variable">mockRepository</span> = <span class="code-keyword">new</span> <span class="code-class">Mock</span>&lt;<span class="code-class">IProductRepository</span>&gt;();

<span class="code-comment">// Setup method to return specific value</span>
<span class="code-variable">mockRepository</span>
    .<span class="code-method">Setup</span>(<span class="code-variable">r</span> => <span class="code-variable">r</span>.<span class="code-method">GetById</span>(<span class="code-number">1</span>))
    .<span class="code-method">Returns</span>(<span class="code-keyword">new</span> <span class="code-class">Product</span> { <span class="code-variable">Id</span> = <span class="code-number">1</span>, <span class="code-variable">Name</span> = <span class="code-string">"Laptop"</span> });</code></pre>

                <h3>It.IsAny&lt;T&gt;</h3>
                <p>Match any argument of type T.</p>

                <div class="code-header">
                    <span class="code-filename">Any Argument</span>
                    <span class="code-language">C#</span>
                </div>
                <pre><code><span class="code-variable">mockRepository</span>
    .<span class="code-method">Setup</span>(<span class="code-variable">r</span> => <span class="code-variable">r</span>.<span class="code-method">GetById</span>(<span class="code-class">It</span>.<span class="code-method">IsAny</span>&lt;<span class="code-type">int</span>&gt;()))
    .<span class="code-method">Returns</span>(<span class="code-keyword">new</span> <span class="code-class">Product</span> { <span class="code-variable">Name</span> = <span class="code-string">"Test Product"</span> });</code></pre>

                <h3>ReturnsAsync</h3>
                <p>For async methods.</p>

                <div class="code-header">
                    <span class="code-filename">Async Setup</span>
                    <span class="code-language">C#</span>
                </div>
                <pre><code><span class="code-variable">mockRepository</span>
    .<span class="code-method">Setup</span>(<span class="code-variable">r</span> => <span class="code-variable">r</span>.<span class="code-method">GetByIdAsync</span>(<span class="code-number">1</span>))
    .<span class="code-method">ReturnsAsync</span>(<span class="code-keyword">new</span> <span class="code-class">Product</span> { <span class="code-variable">Id</span> = <span class="code-number">1</span> });</code></pre>

                <div class="section-divider"></div>

                <h2>Verify Method Calls</h2>

                <div class="code-header">
                    <span class="code-filename">Verify</span>
                    <span class="code-language">C#</span>
                </div>
                <pre><code><span class="code-comment">// Verify method was called once</span>
<span class="code-variable">mockRepository</span>.<span class="code-method">Verify</span>(<span class="code-variable">r</span> => <span class="code-variable">r</span>.<span class="code-method">Add</span>(<span class="code-class">It</span>.<span class="code-method">IsAny</span>&lt;<span class="code-class">Product</span>&gt;()), <span class="code-class">Times</span>.<span class="code-method">Once</span>());

<span class="code-comment">// Verify method was never called</span>
<span class="code-variable">mockRepository</span>.<span class="code-method">Verify</span>(<span class="code-variable">r</span> => <span class="code-variable">r</span>.<span class="code-method">Delete</span>(<span class="code-class">It</span>.<span class="code-method">IsAny</span>&lt;<span class="code-type">int</span>&gt;()), <span class="code-class">Times</span>.<span class="code-method">Never</span>());</code></pre>

                <h2>InvenTrack Example</h2>

                <div class="code-header">
                    <span class="code-filename">IProductRepository.cs</span>
                    <span class="code-language">C#</span>
                </div>
                <pre><code><span class="code-keyword">public</span> <span class="code-keyword">interface</span> <span class="code-class">IProductRepository</span>
{
    <span class="code-class">Task</span>&lt;<span class="code-class">Product</span>&gt; <span class="code-method">GetByIdAsync</span>(<span class="code-type">int</span> <span class="code-variable">id</span>);
    <span class="code-class">Task</span> <span class="code-method">AddAsync</span>(<span class="code-class">Product</span> <span class="code-variable">product</span>);
    <span class="code-class">Task</span> <span class="code-method">UpdateAsync</span>(<span class="code-class">Product</span> <span class="code-variable">product</span>);
}</code></pre>

                <div class="code-header">
                    <span class="code-filename">ProductServiceTests.cs</span>
                    <span class="code-language">C#</span>
                </div>
                <pre><code><span class="code-keyword">public</span> <span class="code-keyword">class</span> <span class="code-class">ProductServiceTests</span>
{
    [<span class="code-class">Fact</span>]
    <span class="code-keyword">public</span> <span class="code-keyword">async</span> <span class="code-class">Task</span> <span class="code-method">GetProduct_ExistingId_ReturnsProduct</span>()
    {
        <span class="code-comment">// Arrange</span>
        <span class="code-keyword">var</span> <span class="code-variable">mockRepo</span> = <span class="code-keyword">new</span> <span class="code-class">Mock</span>&lt;<span class="code-class">IProductRepository</span>&gt;();
        <span class="code-variable">mockRepo</span>
            .<span class="code-method">Setup</span>(<span class="code-variable">r</span> => <span class="code-variable">r</span>.<span class="code-method">GetByIdAsync</span>(<span class="code-number">1</span>))
            .<span class="code-method">ReturnsAsync</span>(<span class="code-keyword">new</span> <span class="code-class">Product</span> { <span class="code-variable">Id</span> = <span class="code-number">1</span>, <span class="code-variable">Name</span> = <span class="code-string">"Laptop"</span> });

        <span class="code-keyword">var</span> <span class="code-variable">service</span> = <span class="code-keyword">new</span> <span class="code-class">ProductService</span>(<span class="code-variable">mockRepo</span>.<span class="code-variable">Object</span>);

        <span class="code-comment">// Act</span>
        <span class="code-keyword">var</span> <span class="code-variable">result</span> = <span class="code-keyword">await</span> <span class="code-variable">service</span>.<span class="code-method">GetProductAsync</span>(<span class="code-number">1</span>);

        <span class="code-comment">// Assert</span>
        <span class="code-class">Assert</span>.<span class="code-method">NotNull</span>(<span class="code-variable">result</span>);
        <span class="code-class">Assert</span>.<span class="code-method">Equal</span>(<span class="code-string">"Laptop"</span>, <span class="code-variable">result</span>.<span class="code-variable">Name</span>);
    }

    [<span class="code-class">Fact</span>]
    <span class="code-keyword">public</span> <span class="code-keyword">async</span> <span class="code-class">Task</span> <span class="code-method">CreateProduct_ValidProduct_CallsRepository</span>()
    {
        <span class="code-comment">// Arrange</span>
        <span class="code-keyword">var</span> <span class="code-variable">mockRepo</span> = <span class="code-keyword">new</span> <span class="code-class">Mock</span>&lt;<span class="code-class">IProductRepository</span>&gt;();
        <span class="code-keyword">var</span> <span class="code-variable">service</span> = <span class="code-keyword">new</span> <span class="code-class">ProductService</span>(<span class="code-variable">mockRepo</span>.<span class="code-variable">Object</span>);
        <span class="code-keyword">var</span> <span class="code-variable">product</span> = <span class="code-keyword">new</span> <span class="code-class">Product</span> { <span class="code-variable">Name</span> = <span class="code-string">"Mouse"</span>, <span class="code-variable">Price</span> = <span class="code-number">25</span> };

        <span class="code-comment">// Act</span>
        <span class="code-keyword">await</span> <span class="code-variable">service</span>.<span class="code-method">CreateProductAsync</span>(<span class="code-variable">product</span>);

        <span class="code-comment">// Assert</span>
        <span class="code-variable">mockRepo</span>.<span class="code-method">Verify</span>(<span class="code-variable">r</span> => <span class="code-variable">r</span>.<span class="code-method">AddAsync</span>(<span class="code-variable">product</span>), <span class="code-class">Times</span>.<span class="code-method">Once</span>());
    }
}</code></pre>

                <h2>Key Takeaways</h2>

                <ul>
                    <li><strong>Mocking</strong>: Create fake dependencies</li>
                    <li><strong>Moq</strong>: Popular .NET mocking library</li>
                    <li><strong>Mock&lt;T&gt;</strong>: Create mock of interface</li>
                    <li><strong>Setup()</strong>: Define method behavior</li>
                    <li><strong>Returns()/ReturnsAsync()</strong>: Specify return values</li>
                    <li><strong>It.IsAny&lt;T&gt;()</strong>: Match any argument</li>
                    <li><strong>Verify()</strong>: Ensure methods were called</li>
                </ul>

                <nav class="page-nav">
                    <a href="01-unit-testing-xunit.html" class="prev">Unit Testing with xUnit</a>
                    <a href="03-integration-testing.html" class="next">Integration Testing</a>
                </nav>

            
        <footer class="page-footer">
          Built with ðŸ’œ by <a href="https://akwasi.dev" target="_blank" rel="noopener noreferrer">Akwasi Adu-Kyeremeh</a> for developers who want to truly understand what they're building.
        </footer>

      </div>
        </main>
    </div>
</body>

</html>